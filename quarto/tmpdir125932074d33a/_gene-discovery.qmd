{{< include _setup.qmd >}}  

```{r}
#| label: pubmed
#| fig-cap: "Number of publications per human gene"
#| code-fold: true
#| cache: true
#| message: false
#| warning: false

source(here::here("code", "current_release.R"))
gene_summary <- readRDS(here::here("data", paste0(release, "_gene_summary.Rds"))) #overwrite gene_summary below


gene2pubmed <- 
  read_tsv(gene2pubmed_url, col_names = TRUE) %>% #gene2pubmed_url read from current_release.R
  janitor::clean_names() %>%
  dplyr::filter(number_tax_id == 9606) %>%  #only the rows corresponding to humans (#tax_id = 9606) 
  dplyr::group_by(gene_id) %>% 
  dplyr::count(sort = TRUE) %>% 
  dplyr::left_join(gene_summary, by = c("gene_id" = "ncbi_gene_id")) %>% 
  dplyr::select(gene_id, approved_symbol, n, approved_name) %>% 
  dplyr::filter(!is.na(approved_symbol))

gene2pubmed %>% 
  # ungroup() %>% 
  # slice(1:100) %>% 
  ggplot() +
  geom_point(aes(x = fct_reorder(approved_symbol, n), y = n), alpha = 0.5) +
  geom_text_repel(data = subset(gene2pubmed, n > 3000),
                  aes(x = fct_reorder(approved_symbol, n), y = n, label = approved_symbol)) +
  coord_cartesian(xlim = c(0, 33000)) +
  labs(x = "Human Gene", 
       y = "Number of Publications") +
  theme_ddh(grid = "y",
            axistext = "y", 
            panelbackground = FALSE) +
  NULL
```
