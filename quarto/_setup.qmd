```{r}
#| label: setup
#| include: false

#LOAD LIBRARIES AND FUNCTIONS-----
library(here)
library(ddh)
library(ggplot2) #library(tidyverse)
library(gt)
library(patchwork)

source('graphs.R')

#LOAD DATA-----
#app_data_dir <- here::here("data")
load_ddh_data(app_data_dir = here::here("data"))

#CONVERT PARAMS TO LIST----
input_report = list(
  type = params$type, 
  subtype = params$subtype, 
  query = unlist(stringr::str_split(params$query, pattern = ", ")), 
  content = unlist(stringr::str_split(params$content, pattern = ", "))
)

#GET PRIVATE MESSAGES-----
private <- function(x, publicValue=NULL) {
  if (privateMode == TRUE) { x } else { publicValue }
}

private_message_html <- "This analysis is currently in Beta, and is only available to premium subscribers. If you want to upgrade to support this project and access these data, subscribe at ', a(href = 'http://www.datadrivenhypothesis.com', 'datadrivenhypothesis.com')"
private_message_md <- "This analysis is currently in Beta, and is only available to premium subscribers. If you want to upgrade to support this project and access these data, subscribe at [datadrivenhypothesis.com](http://www.datadrivenhypothesis.com)"

private_msg <- function() {
  if (privateMode == FALSE) {
    htmltools::tagList(private_message_html) 
  }
}

#QUERY URL
if(length(input_report$content) > 1){content <- stringr::str_replace_all(params$content, pattern = " ", replacement = "%20")} else {content <- params$content}

base_url <- dplyr::if_else(params$private == "true", paste0("datadrivenhypothesis.com"), paste0("datadrivenhypothesis.org"))
query_url <- glue::glue('https://www.{base_url}/?show=gene&query={content}')

```